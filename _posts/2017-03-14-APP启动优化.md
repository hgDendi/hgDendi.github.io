---
layout: post
comments: true
title: "APP启动优化"
date: 2017-03-14
categories: android
tags: [android]
---

# APP启动优化

## 启动方式

### 冷启动

> 后台没有该应用的进程，这时系统会重新创建一个新的进程分配给该应用，这个启动方式就是冷启动。

### 热启动
>  后台已有该应用的进程(按back键、home键)

## App启动过程
1. 点击Launcher，启动程序，通知ActivityManagerService
2. AMS通知zygote进程孵化出应用进程，分配内存空间等
3. 执行该应用ActivityThread的main方法
4. APP通知AMS，AMS保存一个该应用的代理对象，AMS通过它可以控制应用进程
5. AMS通知应用进程创建入口的Activity实例，执行它的生命周期
   * Application的构造方法
   * attachBaseContext()
   * onCreate()
   * LauncherActivity的构造方法
   * setTheme()设置主题等信息
   * Activity的生命周期

## 启动页优化
设置一个启动页SplashFragment进行过度。并在MainActivity中优先展示SplashFragment，显示完毕后再进行remove。当然MainActivity的主布局可以采用ViewStub进行懒加载。

```Java
protected void oncreate(Bundle savedInstanceState){
  	setContentView();
  	//显示splashFragment
  
  	getWindow().getDecorView().post(new Runnable(){
      	//渲染主界面，用队列
      	viewStub.inflate();
  	});
  
  	//等时间结束后，取消splashFragment，呈现主界面
}
```

## 界面优化
1. 避免UI的过度绘制，减少布局深度
2. 多使用ViewStub，懒加载